<%@page import="com.biosensetek.DBUtils,com.biosensetek.ResultUtil"%>
<%@page import="com.google.gson.JsonObject"%>
<%@page import="java.sql.Connection,java.sql.ResultSet,java.sql.Statement"%>
<%@page import="java.util.Arrays,java.util.List"%>
<%@page contentType="text/html;charset=UTF-8" pageEncoding="UTF-8"%><%
if (session.getAttribute("licence") == null) {
	session.setAttribute("signin.html/return", request.getRequestURI());response.sendRedirect("signin.html");return;
}
try (Connection conn = DBUtils.conn("main")) {
	try (Statement stat = conn.createStatement()) {
		try (ResultSet rs = stat.executeQuery("SELECT COUNT(0)`found`FROM code WHERE status>=0")) {
			ResultUtil.attr(rs, request);
		}
		StringBuilder sql = new StringBuilder();sql
		.append("SELECT uid,name,descp,r.v`type`")
		.append( " FROM `code`c")
		.append( " JOIN r ON r.k=c.type")
		.append(" WHERE status>=0");
		try (ResultSet rs = stat.executeQuery(sql.toString())) {
			request.setAttribute("codes", ResultUtil.jsonlist(rs));
		}
	}
}
%><!DOCTYPE html><html><head><meta charset="UTF-8"><title>程式碼管理</title></head>
<body>
<div class="wrapper wrapper-content animated fadeInRight">
	<div class="row">
	   <div class="col-lg-12">
	       <div class="ibox float-e-margins">
	           <div class="ibox-content">
	               <form role="form" class="form-inline">
	                   <div class="form-group">
	                       <label class="sr-only">Email address</label>
	                       <input type="email" placeholder="Enter email" class="form-control">
	                   </div>
	                   <div class="form-group">
	                       <label class="sr-only">Password</label>
	                       <input type="text" placeholder="Password" class="form-control">
	                   </div>
	                   <button class="btn btn-white" type="submit">搜尋</button>
	               </form>
	           </div>
	       </div>
	   </div>
	</div>
   <div class="row">
      <div class="col-lg-12">
         <div class="ibox float-e-margins">
            <div class="ibox-title">
               <div class="ibox-tools">
                  <a class="collapse-link">
                  <i class="fa fa-chevron-up"></i>
                  </a>
               </div>
            </div>
            <div class="ibox-content">
               <div class="table-responsive">
                  <div class="dataTables_wrapper form-inline dt-bootstrap">
                     <div>共 ${found} 筆</div>
                     <table class="table table-striped table-bordered" role="grid">
                        <thead>
                           <tr role="row"><th>項次</th><th>名稱</th><th>種類</th><th>狀態</th>
                              <th style="width:180px;"><a href="#"><i class="fa fa-plus text-warning"></i></a></th>
                           </tr>
                        </thead>
                        <tbody><%int i=0;
                        for (JsonObject j : (List<JsonObject>) request.getAttribute("codes")) {%>
                           <tr class="odd" role="row">
                              <td><%=(++i)%></td><td><%=j.get("name").getAsString()%></td><td><%=j.get("type").getAsString()%></td>
                              <td><span class="badge badge-primary">使用中</span></td>
                              <td><a href="#"><i class="fa fa-cog text-navy"></i></a>&nbsp;
                              <a href="#"><i class="fa fa-pencil text-success"></i></a>
                              </td>
                           </tr>
                        <%}
                        %></tbody>
                     </table>
                     <div class="dataTables_paginate"><jsp:include page="/WEB-INF/unit/pager.jsp"/></div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>
</body>
</html><%
request.setAttribute("breadcrumb", Arrays.asList("帳號管理"));
%>